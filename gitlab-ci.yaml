stages:
  - build
  - deploy

variables:
  DOCKER_COMPOSE_FILE: docker-compose.${CI_COMMIT_REF_SLUG}.yaml

# Build Frontend Only If Changed
build_frontend:
  stage: build
  only:
    - dev
    - main
  rules:
    - changes:
        - frontend/** 
  services:
    - docker:dind
  script:
    - docker-compose -f $DOCKER_COMPOSE_FILE build frontend

# Build Backend Only If Changed
build_backend:
  stage: build
  only:
    - dev
    - main
  rules:
    - changes:
        - backend/** 
  services:
    - docker:dind
  script:
    - docker-compose -f $DOCKER_COMPOSE_FILE build backend


deploy:
  stage: deploy
  only:
    - dev
    - main
  services:
    - docker:dind
  script:
    - docker-compose -f $DOCKER_COMPOSE_FILE up -d --no-build